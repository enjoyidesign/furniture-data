<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬ç›Šå®¶å…·å†åˆ©ç”¨å¹³å° - è³‡æ–™æŸ¥è©¢ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #d4af37;
            --primary-dark: #b8860b;
            --primary-light: #f5e7c1;
            --accent-color: #c0a060;
            --bg-color: #ffffff;
            --text-color: #333;
            --border-radius: 16px;
            --shadow: 0 8px 20px rgba(212, 175, 55, 0.1);
            --metallic-gradient: linear-gradient(135deg, #f5e7c1 0%, #d4af37 50%, #f5e7c1 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            background-image: 
                radial-gradient(circle at 100% 100%, rgba(212, 175, 55, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 0% 0%, rgba(212, 175, 55, 0.05) 0%, transparent 50%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 0;
            background: var(--metallic-gradient);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .shimmer {
            position: absolute;
            top: 0;
            left: -150%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 5s infinite;
            transform: skewX(-20deg);
            z-index: 1;
        }
        
        @keyframes shimmer {
            0% { left: -150%; }
            100% { left: 150%; }
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        .search-panel {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .form-group {
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-end;
        }
        
        .form-col {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4b5563;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: #fff;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }
        
        .search-btn {
            background: var(--metallic-gradient);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .search-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 100%);
            z-index: 1;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.25);
        }
        
        .search-btn:active {
            transform: translateY(1px);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f9f7f2 100%);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            transition: all 0.3s;
            border: 1px solid rgba(212, 175, 55, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(212, 175, 55, 0.05) 0%, rgba(212, 175, 55, 0) 100%);
            z-index: 1;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.15);
            border-color: rgba(212, 175, 55, 0.3);
        }
        
        .stat-card h3 {
            font-size: 1rem;
            color: #4b5563;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary-dark), var(--primary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .results-table {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(212, 175, 55, 0.15);
            position: relative;
            /* æ‰‹æ©Ÿç‰ˆæ»‘å‹•å„ªåŒ– */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 800px; /* ç¢ºä¿è¡¨æ ¼æœ‰æœ€å°å¯¬åº¦ï¼Œå¼·åˆ¶å‡ºç¾æ»¾å‹•æ¢ */
        }
        
        thead {
            background: var(--metallic-gradient);
            color: white;
            position: relative;
        }
        
        th, td {
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œï¼Œä¿æŒæ¬„ä½å®Œæ•´ */
            min-width: 100px;   /* è¨­å®šæœ€å°æ¬„ä½å¯¬åº¦ */
        }
        
        th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            position: relative;
            z-index: 2;
        }
        
        th:first-child { border-top-left-radius: var(--border-radius); }
        th:last-child { border-top-right-radius: var(--border-radius); }
        
        tbody tr:last-child td:first-child { border-bottom-left-radius: var(--border-radius); }
        tbody tr:last-child td:last-child { border-bottom-right-radius: var(--border-radius); }
        
        td {
            padding: 16px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
            transition: background 0.3s ease;
        }
        
        tbody tr:hover td {
            background: rgba(212, 175, 55, 0.05);
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        .status-badge {
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-listed {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: #0d47a1;
            border: 1px solid rgba(13, 71, 161, 0.1);
        }
        
        .status-closed {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            color: #1b5e20;
            border: 1px solid rgba(27, 94, 32, 0.1);
        }
        
        .status-reserved {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            color: #ff6f00;
            border: 1px solid rgba(255, 111, 0, 0.1);
        }
        
        .status-registered {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #6a1b9a;
            border: 1px solid rgba(106, 27, 154, 0.1);
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
            position: relative;
            z-index: 2;
        }
        
        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            background: linear-gradient(to right, var(--primary-dark), var(--primary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #fecaca;
        }
        
        .connection-status {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: center;
        }
        
        .status-connected {
            color: #059669;
        }
        
        .status-error {
            color: #dc2626;
        }
        
        .channel-stats {
            margin-top: 40px;
            position: relative;
            z-index: 2;
        }
        
        .channel-stats h3 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.2rem;
            text-align: left;
        }
        
        .channel-stats .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 0;
        }
        
        .channel-stats .stat-card {
            padding: 20px;
            font-size: 0.9rem;
        }
        
        .channel-stats .stat-number {
            font-size: 2rem;
        }
        
        .gold-stat-card-1 {
            background: linear-gradient(135deg, #f5e7c1 0%, #d4af37 100%);
            color: #5d4037;
        }
        
        .gold-stat-card-2 {
            background: linear-gradient(135deg, #e6d7b9 0%, #c0a060 100%);
            color: #5d4037;
        }
        
        .gold-stat-card-3 {
            background: linear-gradient(135deg, #d4c19a 0%, #b8860b 100%);
            color: #fff;
        }
        
        .gold-text {
            background: linear-gradient(to right, #5d4037, #8d6e63);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .white-text {
            -webkit-text-fill-color: white;
        }
        
        .metallic-element {
            position: relative;
            overflow: hidden;
        }
        
        .metallic-shimmer {
            position: absolute;
            top: 0;
            left: -150%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 5s infinite;
            transform: skewX(-20deg);
            z-index: 1;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            /* æ‰‹æ©Ÿç‰ˆè¡¨æ ¼å„ªåŒ– */
            .results-table {
                margin: 0 -10px; /* ç¨å¾®çªå‡ºå®¹å™¨é‚Šç•Œ */
                border-radius: 12px;
            }
            
            table {
                min-width: 600px; /* æ‰‹æ©Ÿç‰ˆæœ€å°å¯¬åº¦ */
            }
            
            th, td {
                padding: 12px 10px; /* ç¸®å°é–“è· */
                font-size: 0.9rem;  /* ç¨å¾®ç¸®å°å­—é«” */
                min-width: 80px;    /* æ‰‹æ©Ÿç‰ˆæœ€å°æ¬„å¯¬ */
            }
            
            /* æ–°å¢æ»‘å‹•æç¤º */
            .results-table::after {
                content: "ğŸ‘ˆ æ»‘å‹•æŸ¥çœ‹æ›´å¤šæ¬„ä½";
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(212, 175, 55, 0.9);
                color: white;
                padding: 5px 10px;
                border-radius: 15px;
                font-size: 0.8rem;
                z-index: 10;
                animation: fadeInOut 3s ease-in-out;
            }
            
            @keyframes fadeInOut {
                0%, 70% { opacity: 1; }
                100% { opacity: 0; }
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header metallic-element">
            <div class="metallic-shimmer"></div>
            <h1>ğŸ¡ å…¬ç›Šå®¶å…·å†åˆ©ç”¨å¹³å°</h1>
            <p>æŸ¥è©¢å®¶å…·ä¸Šæ¶ã€çµæ¡ˆã€é ç´„ã€è¨»å†ŠåŠç™»å…¥è¨˜éŒ„</p>
        </div>

        <!-- é€£æ¥ç‹€æ…‹é¡¯ç¤º -->
        <div class="connection-status" id="connectionStatus">
            <div class="loading-spinner" style="width: 20px; height: 20px;"></div>
            æ­£åœ¨é€£æ¥è³‡æ–™åº«...
        </div>

        <div class="search-panel metallic-element">
            <div class="metallic-shimmer"></div>
            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="startDate">èµ·å§‹æ—¥æœŸ</label>
                        <input type="date" id="startDate" name="startDate" value="2025-05-01">
                    </div>
                    <div class="form-col">
                        <label for="endDate">çµæŸæ—¥æœŸ</label>
                        <input type="date" id="endDate" name="endDate" value="2025-06-30">
                    </div>
                    <div class="form-col">
                        <label for="queryType">æŸ¥è©¢é¡å‹</label>
                        <select id="queryType" name="queryType">
                            <option value="">è«‹é¸æ“‡æŸ¥è©¢é¡å‹</option>
                            <option value="listed">ä¸Šæ¶</option>
                            <option value="closed">çµæ¡ˆ</option>
                            <option value="reserved">é ç´„</option>
                            <option value="registered">è¨»å†Š</option>
                            <option value="login">ç™»å…¥æ¬¡æ•¸</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <button class="search-btn metallic-element" onclick="performSearch()" id="searchBtn">
                            <div class="metallic-shimmer"></div>
                            ğŸ” æŸ¥è©¢
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section metallic-element">
            <div class="metallic-shimmer"></div>
            <div class="stats-grid" id="statsGrid" style="display: none;">
                <div class="stat-card metallic-element">
                    <div class="metallic-shimmer"></div>
                    <h3>æŸ¥è©¢çµæœ</h3>
                    <div class="stat-number" id="totalCount">0</div>
                    <div>ç­†è³‡æ–™</div>
                </div>
                <div class="stat-card metallic-element">
                    <div class="metallic-shimmer"></div>
                    <h3>æŸ¥è©¢ç¯„åœ</h3>
                    <div class="stat-number" id="dateRange">-</div>
                    <div>å¤©</div>
                </div>
                <div class="stat-card metallic-element">
                    <div class="metallic-shimmer"></div>
                    <h3>æŸ¥è©¢é¡å‹</h3>
                    <div class="stat-number" id="queryTypeDisplay">-</div>
                    <div>é …ç›®</div>
                </div>
            </div>

            <div id="resultsContainer">
                <div class="no-results">
                    <div class="no-results-icon">ğŸ“Š</div>
                    <h3>è«‹é¸æ“‡æŸ¥è©¢æ¢ä»¶é–‹å§‹æœå°‹</h3>
                    <p>è¨­å®šæ—¥æœŸç¯„åœå’ŒæŸ¥è©¢é¡å‹å¾Œï¼Œé»æ“ŠæŸ¥è©¢æŒ‰éˆ•</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Sheets è¨­å®š - å¯«æ­»åœ¨ç¨‹å¼ç¢¼ä¸­
        const SHEETS_CONFIG = {
            apiKey: 'AIzaSyAvVL4Dmi64x24XBvKYvaLGc3G6dmXEAqo',
            
            // è©¦ç®—è¡¨1 - ç”¨æˆ¶ç›¸é—œè³‡æ–™
            userSpreadsheetId: '1sOgdXH2fjVPPpbEWkb7HIOX7rKMJeZyMpwbPWMBllCc',
            sheets: {
                suppliers: 'å®¶å…·ä¾›æ‡‰è€…è³‡æ–™è¡¨',      // ID: 657953189
                users: 'ä½¿ç”¨è€…è³‡æ–™è¡¨',             // ID: 598580565  
                admins: 'ç®¡ç†è€…è³‡æ–™è¡¨',            // ID: 815365146
                loginRecords: 'ä½¿ç”¨ç´€éŒ„'           // ID: 1086164868
            },
            
            // è©¦ç®—è¡¨2 - å®¶å…·ç›¸é—œè³‡æ–™
            furnitureSpreadsheetId: '1fzBGMAMXK8vDHK0V_s94Rn-rLFxNDcTqnFdV2vC8V5s',
            furnitureSheets: {
                furniture: 'å®¶å…·è³‡æ–™ç¸½è¡¨',         // ID: 1638708033
                reservations: 'å®¶å…·é ç´„ç™»è¨˜è¡¨'     // ID: 283536914
            }
        };

        let isConnected = false;

        // Google Sheets API åŠŸèƒ½
        async function fetchSheetData(spreadsheetId, sheetName) {
            const range = `${sheetName}!A:AZ`;  // æ“´å±•åˆ°AZæ¬„ä»¥åŒ…å«ADæ¬„
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${SHEETS_CONFIG.apiKey}`;
            
            console.log('è«‹æ±‚ URL:', url);
            
            try {
                const response = await fetch(url);
                console.log('å›æ‡‰ç‹€æ…‹:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('éŒ¯èª¤å›æ‡‰:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('å–å¾—è³‡æ–™:', data);
                return data.values || [];
            } catch (error) {
                console.error('ç²å– Google Sheets è³‡æ–™å¤±æ•—:', error);
                throw error;
            }
        }

        function arrayToObjects(data) {
            if (!data || data.length < 2) return [];
            
            const headers = data[0];
            return data.slice(1).map(row => {
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = row[index] || '';
                });
                return obj;
            });
        }

        async function getAllSheetsData() {
            try {
                // ç²å–ç”¨æˆ¶ç›¸é—œè³‡æ–™
                const [suppliersData, usersData, adminsData, loginData] = await Promise.all([
                    fetchSheetData(SHEETS_CONFIG.userSpreadsheetId, SHEETS_CONFIG.sheets.suppliers),
                    fetchSheetData(SHEETS_CONFIG.userSpreadsheetId, SHEETS_CONFIG.sheets.users),
                    fetchSheetData(SHEETS_CONFIG.userSpreadsheetId, SHEETS_CONFIG.sheets.admins),
                    fetchSheetData(SHEETS_CONFIG.userSpreadsheetId, SHEETS_CONFIG.sheets.loginRecords)
                ]);

                // ç²å–å®¶å…·ç›¸é—œè³‡æ–™
                const [furnitureData, reservationData] = await Promise.all([
                    fetchSheetData(SHEETS_CONFIG.furnitureSpreadsheetId, SHEETS_CONFIG.furnitureSheets.furniture),
                    fetchSheetData(SHEETS_CONFIG.furnitureSpreadsheetId, SHEETS_CONFIG.furnitureSheets.reservations)
                ]);

                return {
                    suppliers: arrayToObjects(suppliersData),
                    users: arrayToObjects(usersData),
                    admins: arrayToObjects(adminsData),
                    loginRecords: arrayToObjects(loginData),
                    furniture: arrayToObjects(furnitureData),
                    reservations: arrayToObjects(reservationData)
                };
            } catch (error) {
                console.error('ç²å–è³‡æ–™å¤±æ•—:', error);
                throw error;
            }
        }

        async function testConnection() {
            try {
                console.log('é–‹å§‹æ¸¬è©¦é€£æ¥...');
                const testData = await fetchSheetData(SHEETS_CONFIG.userSpreadsheetId, SHEETS_CONFIG.sheets.suppliers);
                console.log('æ¸¬è©¦è³‡æ–™:', testData);
                
                if (testData && testData.length > 0) {
                    isConnected = true;
                    updateConnectionStatus('âœ… è³‡æ–™åº«é€£æ¥æˆåŠŸ', 'status-connected');
                    return true;
                } else {
                    isConnected = false;
                    updateConnectionStatus('âŒ è³‡æ–™åº«é€£æ¥å¤±æ•—ï¼šç„¡æ³•å–å¾—è³‡æ–™', 'status-error');
                    return false;
                }
            } catch (error) {
                console.error('é€£æ¥æ¸¬è©¦å¤±æ•—:', error);
                isConnected = false;
                updateConnectionStatus('âŒ è³‡æ–™åº«é€£æ¥å¤±æ•—: ' + error.message, 'status-error');
                return false;
            }
        }

        function updateConnectionStatus(message, className) {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function normalizeDate(dateStr) {
            if (!dateStr) return null;
            return dateStr.replace(/\//g, '-');
        }

        function isDateInRange(dateStr, startDate, endDate) {
            if (!dateStr) return false;
            
            const normalizedDate = normalizeDate(dateStr);
            const date = new Date(normalizedDate);
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            return date >= start && date <= end;
        }

        async function performSearch() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const queryType = document.getElementById('queryType').value;
            const searchBtn = document.getElementById('searchBtn');

            if (!startDate || !endDate || !queryType) {
                showError('è«‹å¡«å¯«å®Œæ•´çš„æŸ¥è©¢æ¢ä»¶');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showError('èµ·å§‹æ—¥æœŸä¸èƒ½æ™šæ–¼çµæŸæ—¥æœŸ');
                return;
            }

            if (!isConnected) {
                showError('ç„¡æ³•é€£æ¥åˆ°è³‡æ–™åº«ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£æ¥');
                return;
            }

            searchBtn.disabled = true;
            showLoading();
            
            try {
                const data = await getAllSheetsData();
                const results = getSearchResults(data, startDate, endDate, queryType);
                displayResults(results, startDate, endDate, queryType);
            } catch (error) {
                showError(`æŸ¥è©¢å¤±æ•—: ${error.message}`);
            } finally {
                searchBtn.disabled = false;
            }
        }

        function getSearchResults(data, startDate, endDate, queryType) {
            let results = [];

            switch (queryType) {
                case 'listed':
                    // å®¶å…·ä¸Šæ¶æŸ¥è©¢ - ä½¿ç”¨ Pæ¬„ï¼šä¸Šæ¶æ™‚é–“
                    results = data.furniture.filter(item => {
                        const listedDate = getColumnValue(item, 'P', 'ä¸Šæ¶æ™‚é–“');
                        return isDateInRange(listedDate, startDate, endDate);
                    }).map(item => ({
                        furnitureCode: getColumnValue(item, 'G', 'å®¶å…·ç·¨è™Ÿ'),
                        furnitureName: getColumnValue(item, 'H', 'å®¶å…·åç¨±'),
                        uploader: getColumnValue(item, 'B', 'ä¸Šå‚³äººå§“å'),
                        company: getColumnValue(item, 'E', 'å…¬å¸åç¨±'),
                        listedDate: getColumnValue(item, 'P', 'ä¸Šæ¶æ™‚é–“'),
                        status: getColumnValue(item, 'S', 'ç‹€æ…‹'),
                        type: 'ä¸Šæ¶'
                    }));
                    break;

                case 'closed':
                    // å®¶å…·çµæ¡ˆæŸ¥è©¢ - ä½¿ç”¨ ADæ¬„ï¼šçµæ¡ˆæ—¥æœŸ
                    results = data.furniture.filter(item => {
                        console.log('å®Œæ•´çš„å®¶å…·è³‡æ–™é …ç›®:', item); // é¡¯ç¤ºæ•´ç­†è³‡æ–™
                        console.log('æ‰€æœ‰å¯ç”¨çš„æ¬„ä½:', Object.keys(item)); // é¡¯ç¤ºæ‰€æœ‰æ¬„ä½åç¨±
                        
                        const closedDate = getColumnValue(item, 'AD', 'çµæ¡ˆæ—¥æœŸ');
                        console.log('æª¢æŸ¥çµæ¡ˆè³‡æ–™ - å®¶å…·ç·¨è™Ÿ:', getColumnValue(item, 'G', 'å®¶å…·ç·¨è™Ÿ')); 
                        console.log('çµæ¡ˆæ—¥æœŸ (ADæ¬„):', closedDate); 
                        console.log('æ—¥æœŸç¯„åœæª¢æŸ¥:', isDateInRange(closedDate, startDate, endDate)); 
                        return closedDate && isDateInRange(closedDate, startDate, endDate);
                    }).map(item => ({
                        furnitureCode: getColumnValue(item, 'G', 'å®¶å…·ç·¨è™Ÿ'),
                        furnitureName: getColumnValue(item, 'H', 'å®¶å…·åç¨±'),
                        uploader: getColumnValue(item, 'B', 'ä¸Šå‚³äººå§“å'),
                        closedDate: getColumnValue(item, 'AD', 'çµæ¡ˆæ—¥æœŸ'),
                        status: getColumnValue(item, 'S', 'ç‹€æ…‹'),
                        type: 'çµæ¡ˆ'
                    }));
                    
                    console.log('çµæ¡ˆæŸ¥è©¢çµæœ:', results); 
                    break;

                case 'reserved':
                    // é ç´„æŸ¥è©¢ - ä½¿ç”¨ Læ¬„ï¼šç™»è¨˜é ç´„æ—¥æœŸ
                    results = data.reservations.filter(item => {
                        const reservedDate = getColumnValue(item, 'L', 'ç™»è¨˜é ç´„æ—¥æœŸ');
                        console.log('æª¢æŸ¥é ç´„è³‡æ–™:', item); // åµéŒ¯ç”¨
                        console.log('é ç´„æ—¥æœŸ:', reservedDate); // åµéŒ¯ç”¨
                        console.log('æ—¥æœŸç¯„åœæª¢æŸ¥:', isDateInRange(reservedDate, startDate, endDate)); // åµéŒ¯ç”¨
                        return isDateInRange(reservedDate, startDate, endDate);
                    }).map(item => ({
                        furnitureCode: getColumnValue(item, 'E', 'å®¶å…·ç·¨è™Ÿ'),
                        furnitureName: getColumnValue(item, 'F', 'å®¶å…·åç¨±'),
                        uploader: getColumnValue(item, 'B', 'ä¸Šå‚³äººå§“å'),
                        uploaderPhone: getColumnValue(item, 'C', 'é€£çµ¡é›»è©±'),
                        uploaderEmail: getColumnValue(item, 'D', 'E-mail'),
                        reserver: getColumnValue(item, 'I', 'é ç´„äººå§“å'), // ä¿®æ­£ï¼šæ”¹ç‚ºIæ¬„çš„é ç´„äººå§“å
                        reservedDate: getColumnValue(item, 'L', 'ç™»è¨˜é ç´„æ—¥æœŸ'),
                        address: getColumnValue(item, 'G', 'å®¶å…·åœ°å€'),
                        type: 'é ç´„'
                    }));
                    
                    console.log('é ç´„æŸ¥è©¢çµæœ:', results); // åµéŒ¯ç”¨
                    break;

                case 'registered':
                    // è¨»å†ŠæŸ¥è©¢ - åˆä½µæ‰€æœ‰ä½¿ç”¨è€…é¡å‹
                    const allUsers = [
                        ...data.suppliers.map(item => ({
                            lineId: getColumnValue(item, 'A', 'LINE ID'),
                            name: getColumnValue(item, 'B', 'å§“å'),
                            company: getColumnValue(item, 'C', 'å…¬å¸åç¨±'),
                            phone: getColumnValue(item, 'E', 'é€£çµ¡é›»è©±'),
                            email: getColumnValue(item, 'F', 'E-mail'),
                            location: getColumnValue(item, 'G', 'æ‰€åœ¨ç¸£å¸‚'),
                            registeredDate: getColumnValue(item, 'H', 'è¨»å†Šæ—¥æœŸ'),
                            channel: 'å®¶å…·ä¾›æ‡‰è€…'
                        })),
                        ...data.users.map(item => ({
                            lineId: getColumnValue(item, 'A', 'LINE ID'),
                            name: getColumnValue(item, 'B', 'å§“å'),
                            phone: getColumnValue(item, 'C', 'é€£çµ¡é›»è©±'),
                            email: getColumnValue(item, 'D', 'E-mail'),
                            location: getColumnValue(item, 'E', 'æ‰€åœ¨ç¸£å¸‚'),
                            registeredDate: getColumnValue(item, 'F', 'è¨»å†Šæ—¥æœŸ'),
                            channel: 'ä½¿ç”¨è€…'
                        })),
                        ...data.admins.map(item => ({
                            lineId: getColumnValue(item, 'A', 'LINE ID'),
                            name: getColumnValue(item, 'B', 'å§“å'),
                            phone: getColumnValue(item, 'C', 'é€£çµ¡é›»è©±'),
                            email: getColumnValue(item, 'D', 'E-mail'),
                            registeredDate: getColumnValue(item, 'E', 'è¨»å†Šæ—¥æœŸ'),
                            channel: 'ç®¡ç†è€…'
                        }))
                    ];
                    
                    results = allUsers.filter(item => 
                        isDateInRange(item.registeredDate, startDate, endDate)
                    ).map(item => ({
                        ...item,
                        type: 'è¨»å†Š'
                    }));
                    break;

                case 'login':
                    // ç™»å…¥æ¬¡æ•¸çµ±è¨ˆ - ä½¿ç”¨ ä½¿ç”¨ç´€éŒ„è¡¨
                    const loginCounts = {};
                    data.loginRecords.forEach(record => {
                        const loginDate = getColumnValue(record, 'D', 'ç™»å…¥æ—¥æœŸ');
                        if (isDateInRange(loginDate, startDate, endDate)) {
                            const userId = getColumnValue(record, 'A', 'LINE ID');
                            const userName = getColumnValue(record, 'F', 'ä½¿ç”¨è€…å§“å');
                            const channel = getColumnValue(record, 'B', 'ç™»å…¥çš„LINE@');
                            
                            if (!loginCounts[userId]) {
                                loginCounts[userId] = {
                                    userId: userId,
                                    userName: userName,
                                    channels: {},
                                    totalCount: 0,
                                    type: 'ç™»å…¥æ¬¡æ•¸'
                                };
                            }
                            
                            if (!loginCounts[userId].channels[channel]) {
                                loginCounts[userId].channels[channel] = 0;
                            }
                            loginCounts[userId].channels[channel]++;
                            loginCounts[userId].totalCount++;
                        }
                    });
                    results = Object.values(loginCounts);
                    break;
            }

            return results;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šç²å–æ¬„ä½å€¼ï¼ˆæ”¯æŒæ¬„ä½åç¨±å’Œç´¢å¼•ï¼‰
        function getColumnValue(item, columnIndex, columnName) {
            // å…ˆå˜—è©¦ç”¨æ¬„ä½åç¨±
            if (item[columnName] !== undefined && item[columnName] !== '') {
                return item[columnName];
            }
            
            // å†å˜—è©¦ç”¨æ¬„ä½ç´¢å¼•
            if (item[columnIndex] !== undefined && item[columnIndex] !== '') {
                return item[columnIndex];
            }
            
            // å˜—è©¦æ ¹æ“šæ¬„ä½ä½ç½®ç²å–å€¼
            const keys = Object.keys(item);
            const columnPosition = columnIndex.charCodeAt(0) - 65; // A=0, B=1, C=2...
            
            // å°æ–¼é›™å­—æ¯æ¬„ä½ (å¦‚ AD)
            if (columnIndex.length === 2) {
                const firstChar = columnIndex.charCodeAt(0) - 65;
                const secondChar = columnIndex.charCodeAt(1) - 65;
                const position = (firstChar + 1) * 26 + secondChar; // AD = (0+1)*26 + 3 = 29
                if (keys[position] && item[keys[position]] !== undefined && item[keys[position]] !== '') {
                    return item[keys[position]];
                }
            } else {
                // å–®å­—æ¯æ¬„ä½
                if (keys[columnPosition] && item[keys[columnPosition]] !== undefined && item[keys[columnPosition]] !== '') {
                    return item[keys[columnPosition]];
                }
            }
            
            // æœ€å¾Œè¿”å›ç©ºå­—ä¸²
            return '';
        }

        let currentResults = []; // å„²å­˜å®Œæ•´çš„æŸ¥è©¢çµæœ
        let displayLimit = 50;   // é è¨­é¡¯ç¤ºç­†æ•¸
        let currentDisplayCount = 50; // ç›®å‰é¡¯ç¤ºçš„ç­†æ•¸

        function displayResults(results, startDate, endDate, queryType) {
            const statsGrid = document.getElementById('statsGrid');
            const resultsContainer = document.getElementById('resultsContainer');
            
            // å„²å­˜å®Œæ•´çµæœ
            currentResults = results;
            currentDisplayCount = Math.min(displayLimit, results.length);
            
            document.getElementById('totalCount').textContent = results.length;
            document.getElementById('dateRange').textContent = calculateDateRange(startDate, endDate);
            document.getElementById('queryTypeDisplay').textContent = getQueryTypeDisplay(queryType);
            
            statsGrid.style.display = 'grid';

            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">ğŸ”</div>
                        <h3>æŸ¥ç„¡è³‡æ–™</h3>
                        <p>åœ¨æŒ‡å®šçš„æ—¥æœŸç¯„åœå…§æ²’æœ‰æ‰¾åˆ°ç›¸é—œè¨˜éŒ„</p>
                    </div>
                `;
                return;
            }

            // é¡¯ç¤ºçš„è³‡æ–™ï¼ˆå‰50ç­†æˆ–å…¨éƒ¨ï¼‰
            const displayData = results.slice(0, currentDisplayCount);
            
            let tableHTML = `
                <div class="results-table metallic-element">
                    <div class="metallic-shimmer"></div>
                    <table>
                        <thead>
                            <tr>
                                ${getTableHeaders(queryType)}
                            </tr>
                        </thead>
                        <tbody>
                            ${displayData.map(item => getTableRow(item, queryType)).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            // å¦‚æœè³‡æ–™è¶…éç›®å‰é¡¯ç¤ºç­†æ•¸ï¼ŒåŠ ä¸Šé¡¯ç¤ºæ›´å¤šæŒ‰éˆ•
            if (results.length > currentDisplayCount) {
                tableHTML += `
                    <div style="text-align: center; margin-top: 20px;">
                        <div style="color: #6b7280; margin-bottom: 15px; font-size: 0.95rem;">
                            é¡¯ç¤º ${currentDisplayCount} ç­†ï¼Œå…± ${results.length} ç­†è³‡æ–™
                        </div>
                        <button class="search-btn metallic-element" onclick="showMoreResults('${queryType}')" style="width: auto; padding: 12px 30px;">
                            <div class="metallic-shimmer"></div>
                            ğŸ“„ é¡¯ç¤ºæ›´å¤š (é‚„æœ‰ ${results.length - currentDisplayCount} ç­†)
                        </button>
                    </div>
                `;
            } else if (results.length > displayLimit) {
                // å¦‚æœå·²ç¶“é¡¯ç¤ºå…¨éƒ¨ï¼Œé¡¯ç¤ºç¸½ç­†æ•¸
                tableHTML += `
                    <div style="text-align: center; margin-top: 20px;">
                        <div style="color: #6b7280; font-size: 0.95rem;">
                            å·²é¡¯ç¤ºå…¨éƒ¨ ${results.length} ç­†è³‡æ–™
                        </div>
                    </div>
                `;
            }

            if (queryType === 'registered' || queryType === 'login') {
                tableHTML += getChannelStatistics(results, queryType);
            }

            resultsContainer.innerHTML = tableHTML;
            addShimmerToElements();
        }

        function showMoreResults(queryType) {
            // å¢åŠ é¡¯ç¤ºç­†æ•¸
            currentDisplayCount = Math.min(currentDisplayCount + 50, currentResults.length);
            
            // é‡æ–°é¡¯ç¤ºçµæœ
            const displayData = currentResults.slice(0, currentDisplayCount);
            
            // åªæ›´æ–°è¡¨æ ¼å…§å®¹ï¼Œä¸é‡æ–°ç”¢ç”Ÿæ•´å€‹çµæœå€åŸŸ
            const tableBody = document.querySelector('.results-table tbody');
            tableBody.innerHTML = displayData.map(item => getTableRow(item, queryType)).join('');
            
            // æ›´æ–°æˆ–ç§»é™¤é¡¯ç¤ºæ›´å¤šæŒ‰éˆ•
            const showMoreContainer = document.querySelector('.results-section').lastElementChild;
            if (showMoreContainer && showMoreContainer.style && showMoreContainer.style.textAlign === 'center') {
                if (currentResults.length > currentDisplayCount) {
                    showMoreContainer.innerHTML = `
                        <div style="color: #6b7280; margin-bottom: 15px; font-size: 0.95rem;">
                            é¡¯ç¤º ${currentDisplayCount} ç­†ï¼Œå…± ${currentResults.length} ç­†è³‡æ–™
                        </div>
                        <button class="search-btn metallic-element" onclick="showMoreResults('${queryType}')" style="width: auto; padding: 12px 30px;">
                            <div class="metallic-shimmer"></div>
                            ğŸ“„ é¡¯ç¤ºæ›´å¤š (é‚„æœ‰ ${currentResults.length - currentDisplayCount} ç­†)
                        </button>
                    `;
                } else {
                    showMoreContainer.innerHTML = `
                        <div style="color: #6b7280; font-size: 0.95rem;">
                            å·²é¡¯ç¤ºå…¨éƒ¨ ${currentResults.length} ç­†è³‡æ–™
                        </div>
                    `;
                }
                
                // é‡æ–°æ·»åŠ é‡‘å±¬å…‰æ¾¤æ•ˆæœ
                addShimmerToElements();
            }
        }

        function getTableHeaders(queryType) {
            switch (queryType) {
                case 'listed':
                    return `
                        <th>å®¶å…·ç·¨è™Ÿ</th>
                        <th>å®¶å…·åç¨±</th>
                        <th>ä¸Šå‚³äºº</th>
                        <th>å…¬å¸åç¨±</th>
                        <th>ä¸Šæ¶æ™‚é–“</th>
                        <th>ç‹€æ…‹</th>
                    `;
                case 'closed':
                    return `
                        <th>å®¶å…·ç·¨è™Ÿ</th>
                        <th>å®¶å…·åç¨±</th>
                        <th>ä¸Šå‚³äºº</th>
                        <th>çµæ¡ˆæ—¥æœŸ</th>
                        <th>ç‹€æ…‹</th>
                    `;
                case 'reserved':
                    return `
                        <th>å®¶å…·ç·¨è™Ÿ</th>
                        <th>å®¶å…·åç¨±</th>
                        <th>ä¸Šå‚³äºº</th>
                        <th>é ç´„äººå§“å</th>
                        <th>é ç´„æ—¥æœŸ</th>
                    `;
                case 'registered':
                    return `
                        <th>å§“å</th>
                        <th>LINE ID</th>
                        <th>è¨»å†Šé »é“</th>
                        <th>é€£çµ¡é›»è©±</th>
                        <th>æ‰€åœ¨ç¸£å¸‚</th>
                        <th>è¨»å†Šæ—¥æœŸ</th>
                    `;
                case 'login':
                    return `
                        <th>ç”¨æˆ¶åç¨±</th>
                        <th>LINE ID</th>
                        <th>ç¸½ç™»å…¥æ¬¡æ•¸</th>
                        <th>å„é »é“ç™»å…¥æ¬¡æ•¸</th>
                    `;
                default:
                    return '<th>è³‡æ–™</th>';
            }
        }

        function getTableRow(item, queryType) {
            const statusClass = getStatusClass(item.status);
            
            switch (queryType) {
                case 'listed':
                    return `
                        <tr>
                            <td>${item.furnitureCode || '-'}</td>
                            <td>${item.furnitureName || '-'}</td>
                            <td>${item.uploader || '-'}</td>
                            <td>${item.company || '-'}</td>
                            <td>${item.listedDate || '-'}</td>
                            <td><span class="status-badge ${statusClass}">${item.status || '-'}</span></td>
                        </tr>
                    `;
                case 'closed':
                    return `
                        <tr>
                            <td>${item.furnitureCode || '-'}</td>
                            <td>${item.furnitureName || '-'}</td>
                            <td>${item.uploader || '-'}</td>
                            <td>${item.closedDate || '-'}</td>
                            <td><span class="status-badge ${statusClass}">${item.status || '-'}</span></td>
                        </tr>
                    `;
                case 'reserved':
                    return `
                        <tr>
                            <td>${item.furnitureCode || '-'}</td>
                            <td>${item.furnitureName || '-'}</td>
                            <td>${item.uploader || '-'}</td>
                            <td>${item.reserver || '-'}</td>
                            <td>${item.reservedDate || '-'}</td>
                        </tr>
                    `;
                case 'registered':
                    return `
                        <tr>
                            <td>${item.name || '-'}</td>
                            <td>${item.lineId || '-'}</td>
                            <td>${item.channel || '-'}</td>
                            <td>${item.phone || '-'}</td>
                            <td>${item.location || '-'}</td>
                            <td>${item.registeredDate || '-'}</td>
                        </tr>
                    `;
                case 'login':
                    const channelDetails = Object.entries(item.channels)
                        .map(([channel, count]) => `${channel}: ${count}æ¬¡`)
                        .join('<br>');
                    return `
                        <tr>
                            <td>${item.userName || '-'}</td>
                            <td>${item.userId || '-'}</td>
                            <td>${item.totalCount} æ¬¡</td>
                            <td>${channelDetails}</td>
                        </tr>
                    `;
                default:
                    return '<tr><td>æœªçŸ¥è³‡æ–™</td></tr>';
            }
        }

        function getStatusClass(status) {
            switch (status) {
                case 'ä¸Šæ¶':
                case 'å·²ä¸Šæ¶':
                    return 'status-listed';
                case 'çµæ¡ˆ':
                case 'å·²çµæ¡ˆ':
                    return 'status-closed';
                case 'é ç´„':
                case 'å·²é ç´„':
                    return 'status-reserved';
                default:
                    return 'status-listed';
            }
        }

        function getChannelStatistics(results, queryType) {
            if (queryType === 'registered') {
                const channelCounts = {
                    'å®¶å…·ä¾›æ‡‰è€…': 0,
                    'ä½¿ç”¨è€…': 0,
                    'ç®¡ç†è€…': 0
                };

                results.forEach(item => {
                    if (channelCounts.hasOwnProperty(item.channel)) {
                        channelCounts[item.channel]++;
                    }
                });

                return `
                    <div class="channel-stats">
                        <h3>ğŸ“Š é »é“è¨»å†Šçµ±è¨ˆ</h3>
                        <div class="stats-grid">
                            <div class="stat-card gold-stat-card-1 metallic-element">
                                <div class="metallic-shimmer"></div>
                                <h3>å®¶å…·ä¾›æ‡‰è€…</h3>
                                <div class="stat-number gold-text">${channelCounts['å®¶å…·ä¾›æ‡‰è€…']}</div>
                                <div>äººè¨»å†Š</div>
                            </div>
                            <div class="stat-card gold-stat-card-2 metallic-element">
                                <div class="metallic-shimmer"></div>
                                <h3>ä½¿ç”¨è€…</h3>
                                <div class="stat-number gold-text">${channelCounts['ä½¿ç”¨è€…']}</div>
                                <div>äººè¨»å†Š</div>
                            </div>
                            <div class="stat-card gold-stat-card-3 metallic-element">
                                <div class="metallic-shimmer"></div>
                                <h3>ç®¡ç†è€…</h3>
                                <div class="stat-number white-text">${channelCounts['ç®¡ç†è€…']}</div>
                                <div>äººè¨»å†Š</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (queryType === 'login') {
                const channelCounts = {};
                let totalLogins = 0;
                
                results.forEach(item => {
                    Object.entries(item.channels).forEach(([channel, count]) => {
                        if (!channelCounts[channel]) {
                            channelCounts[channel] = 0;
                        }
                        channelCounts[channel] += count;
                        totalLogins += count;
                    });
                });

                // ç¸½è¨ˆå¡ç‰‡ - æ”¾åœ¨æœ€å‰é¢ï¼Œæœ€æ·ºçš„åº•è‰²
                const totalCard = `
                    <div class="stat-card" style="background: linear-gradient(135deg, #faf8f0 0%, #f5e7c1 100%); color: #5d4037; border: 1px solid rgba(212, 175, 55, 0.3);" class="metallic-element">
                        <div class="metallic-shimmer"></div>
                        <h3 style="font-weight: 600;">ä¸‰å¹³å°ç¸½è¨ˆç™»å…¥æ¬¡æ•¸</h3>
                        <div class="stat-number" style="-webkit-text-fill-color: #5d4037; font-weight: 700;">${totalLogins}</div>
                        <div style="font-weight: 500;">æ¬¡ç™»å…¥</div>
                    </div>
                `;

                const channelCards = Object.entries(channelCounts).map(([channel, count], index) => {
                    // æ¼¸è®ŠåŠ æ·±çš„åº•è‰²
                    let cardStyle = '';
                    let textClass = 'gold-text';
                    
                    switch(index) {
                        case 0:
                            cardStyle = 'background: linear-gradient(135deg, #f0e6c7 0%, #e6d7b9 100%); color: #5d4037;';
                            break;
                        case 1:
                            cardStyle = 'background: linear-gradient(135deg, #e6d7b9 0%, #d4c19a 100%); color: #5d4037;';
                            break;
                        case 2:
                            cardStyle = 'background: linear-gradient(135deg, #d4c19a 0%, #b8860b 100%); color: #fff;';
                            textClass = 'white-text';
                            break;
                        default:
                            cardStyle = 'background: linear-gradient(135deg, #b8860b 0%, #9a7009 100%); color: #fff;';
                            textClass = 'white-text';
                    }
                    
                    return `
                        <div class="stat-card metallic-element" style="${cardStyle}">
                            <div class="metallic-shimmer"></div>
                            <h3>${channel}</h3>
                            <div class="stat-number ${textClass}">${count}</div>
                            <div>æ¬¡ç™»å…¥</div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="channel-stats">
                        <h3>ğŸ“Š é »é“ç™»å…¥çµ±è¨ˆ</h3>
                        <div class="stats-grid">
                            ${totalCard}
                            ${channelCards}
                        </div>
                    </div>
                `;
            }
            return '';
        }

        function getQueryTypeDisplay(queryType) {
            const types = {
                'listed': 'ä¸Šæ¶',
                'closed': 'çµæ¡ˆ',
                'reserved': 'é ç´„',
                'registered': 'è¨»å†Š',
                'login': 'ç™»å…¥'
            };
            return types[queryType] || '-';
        }

        function calculateDateRange(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            return diffDays;
        }

        function showLoading() {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>æ­£åœ¨æŸ¥è©¢è³‡æ–™...</p>
                </div>
            `;
        }

        function showError(message) {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div class="error-message">
                    <strong>éŒ¯èª¤ï¼š</strong> ${message}
                </div>
            `;
        }
        
        function addShimmerToElements() {
            const elements = document.querySelectorAll('.metallic-element');
            elements.forEach(element => {
                if (!element.querySelector('.metallic-shimmer')) {
                    const shimmer = document.createElement('div');
                    shimmer.className = 'metallic-shimmer';
                    element.appendChild(shimmer);
                }
            });
        }

        // åˆå§‹åŒ–
        window.onload = async function() {
            console.log('ç³»çµ±è¼‰å…¥å®Œæˆ');
            addShimmerToElements();
            
            const shimmers = document.querySelectorAll('.metallic-shimmer');
            shimmers.forEach((shimmer, index) => {
                shimmer.style.animationDelay = `${index * 0.5}s`;
            });

            // æ¸¬è©¦ Google Sheets é€£æ¥
            await testConnection();
        };
    </script>
</body>
</html>
